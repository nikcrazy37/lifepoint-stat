# Сбор статистики

## Описание

Библиотека предназначена для работы с различными аналитическими данными. Основные функции: положить, забрать.
Есть возможность переключения места хранения данных.

## Конфигурация

Первым делом требуется указать настройки подключения в ***config.ini***.
В качестве примера можно использовать ***example.config.ini*** в корне библиотеки.

## Инициализация

Для сбора статистики переходов на электронный коуч инициализируем ***ECoachController***

На вход он принимает объект хранилища с одним параметром - наименование таблицы ***table***.

Для *ClickHouse* указывается наименование базы данных в префиксе $table = ***database.table***.

```php
$controller = new ECoachController(new Repository($table));
```

Доступные хранилища (*Repository*):
- MySQL;
- ClickHouse.


## Использование

***ECoachController*** реализует два метода для работы с хранилищем:
 - **add** - запись перехода;
 - **get** - получение статистики переходов по фильтру.

### add()

На вход принимает модель ***ECoach***. Пример:

```php
$controller->add(
    new ECoach(
        array(
            "userId" => 1,
            "userName" => "some user name",
            "bankId" => 1,
            "bankName" => "some bank name",
            "departmentId" => 1,
            "departmentName" => "some department name"
        )
    )
);
```

### get()

На вход принимает массив с вложенной структурой. Ключ - наименование фильтра. Значение - массив значений для фильтра. Пример:

```php
$controller->get(
    array(
        "where" => array(
            new Where("dateCreate", ">=", "2023-02-10 00:00:00"),
            new Where("dateCreate", "<=", "2023-02-12 23:59:59"),
        ),
    )
);
```

В данном случае запрос в хранилище фильтруется по "where". В модель ***Where*** кладём:
 - Наименование параметра, по которому фильтруем;
 - Оператор сравнения;
 - Значение для фильтрации.

Параметры будут перечислены в запросе с relation = AND.